# nuscenes数据集实验


## 时序提升效果对比

对比实验
 - f1: uniconv_v0.1_e48_s256x704_v200x200x6_ibaug_v2
 - f2: uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f2s4
 - f3: uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f3s13
 - f4: uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f4s135
 - f5: uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f5s1357
 - f5: uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f5s-3-1+1+3
 - f7: uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f7s-5-3-1+1+3+5

相邻间隔：2帧融合时取历史第5帧，其他多帧融合时按间隔1帧取（每帧时间间隔0.25s）。

测试指标
  - NDS: nuScenes检测分数，由平均平移误差（ATE，m）、平均尺度误差（ASE，1-IOU）、平均方向误差（AOE，rad）、平均速度误差（AVE，m/s）、平均属性误差（AAE，1-acc）和平均精度（mAP）组成。

|id|exp|mATE(↓)|mASE(↓)|mAOE(↓)|mAVE(↓)|mAAE(↓)|mAP(↑)|NDS(↑)|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|0|f1|0.7751|0.2821|0.5602|0.8614| 0.24 |0.2877|0.3720|
|1|f2|0.7354|0.2805|0.4543|0.4403|0.2198|0.3126|0.4433|
|2|f3|0.7058|0.2864|0.4026|0.4324|0.2278|0.3159|0.4525|
|3|f4|0.6946|0.2797|0.3889|0.3781|0.2147|0.3230|0.4659|
|4|f5|0.6838|0.2835|0.4495|0.3677|0.1971|0.3271|0.4654|
|5|f5-d2|0.6933|0.2828|0.4050|0.3956|0.2130|0.3412|0.4716|
|6|f7|0.6560|0.2879|0.3869|0.3525|0.2037|0.3531|0.4878|

提升总结
 - nuScenes检测分数：随着时序长度增加，NDS逐渐降低，到第四帧开始收敛（主要是mAOE开始反弹），四帧融合提升25.2%，双向7帧融合提升31.1%；
 - 平均平移误差：随着时序长度增加误差逐渐减小，五帧融合误差降低11.8%，双向7帧融合误差降低15.4%；
 - 平均尺度误差：长时序对该任务基本无增益；
 - 平均方向误差：四帧融合效果最好，误差降低30.6%，双向7帧融合误差降低30.9%；
 - 平均速度误差：随着时序长度增加误差逐渐减小，五帧融合误差降低57.3%，双向7帧融合误差降低59.1%；
 - 平均属性误差：随着时序长度增加误差逐渐减小，五帧融合误差降低17.9%；
 - 平均精度：随着时序长度增加精度逐渐提升，五帧融合精度提升13.7%，双向7帧融合精度提升22.7%。

结果分析
 - 引入时序多帧融合后对预测结果的位置精度、稳定性以及预测框的属性精度都有提升作用，其中速度预测精度已经能够接近一些Lidar方法的精度。
 - 在当前单向最多5帧的设置下，平移误差、速度误差、属性误差都会持续提升，但是在五帧融合时方向误差变大，猜测是跟当前帧相距太远时时车体方向会有较多的变化，方向特征融合的学习难度有所提高。
 - 当前方法只尝试了引入历史帧的单向多帧融合，考虑到车体前后都有和当前帧match的可融合特征，后续可以继续引入前后时序双向的特征融合探究是否能够产生更多收益，比如前后各取3帧实现7帧融合。
 - 根据当前的实验结果，在和当前帧相近的一个小窗口内实现多帧融合是比较有保证的思路。
 - update: 扩展单向4帧到双向7帧后，平移误差、方向误差和速度误差都有进一步的降低，mAP相比单向4帧提升7.9%，NDS相比单向4帧提升4.7%，达到了当前scale模型下的sota精度，验证了上述猜想的正确性。
 

## cbgs exps
|id|exp|bs|epoch|mAP|NDS|
|:-:|:-:|:-:|:-:|:-:|:-:|
|00|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f1|32|12|0.1929|0.2419|
|00|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f1_cbgs|32|12|0.2612|0.3297|
|00|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f4s135|32|12|0.2068|0.2945|
|00|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f4s135_cbgs|32|12|0.2800|0.4105|


## anchor exps
|id|exp|bs|epoch|mAP|NDS|
|:-:|:-:|:-:|:-:|:-:|:-:|
|00|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f1|32|12|0.1929|0.2419|
|00|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f1_anchor|32|12|0.1869|0.2360|


## seq3.0 exps
|id|exp|bs|epoch|mAP|NDS|
|:-:|:-:|:-:|:-:|:-:|:-:|
|00|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f1|32|12|0.1929|0.2419|
|01|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f2s1|32|12|0.1949|0.2454|
|02|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f2s2|32|12|0.1953|0.2460|
|03|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f2s3|32|12|0.1989|0.2408|
|04|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f2s4|32|12|0.2023|0.2538|
|05|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f2s5|32|12|0.2074|0.2494
|06|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f2s6|32|12|0.2082|0.2539|
|06|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f3s01|32|12|0.1932|0.2545|
|06|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f3s13|32|12|0.2044|0.2868|
|06|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f3s25|32|12|0.2076|0.2504|
|06|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f3s37|32|12|0.2122|0.2828|
|06|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f4s012|32|12|0.1958|0.2771|
|06|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f4s135|32|12|0.2068|0.2945|
|06|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f4s258|32|12|0.2125|0.2678|
|06|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f5s0123|32|12|0.2014|0.2902|
|06|uniconv_v0.1_e12_s256x704_v200x200x6_seq3.1_ibaug_v2_interval4_f5s1357|32|12|0.2180|0.2962|


## seq3.0 exps
|id|exp|bs|epoch|mAP|NDS|
|:-:|:-:|:-:|:-:|:-:|:-:|
|00|uniconv_v0.1_e48_s256x704_v200x200x6_seq2.0_ibaug_v2|32|48|0.3181|0.4450|
|01|uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f2s4|32|48|0.3126|0.4433|
|02|uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f3s13|32|48|0.3159|0.4525|
|03|uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f4s135|32|48|0.3230|0.4659|
|04|uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f5s1357|32|48|0.3271|0.4654|
|05|uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f4s135_cbgs|32|48|0.3252|0.4713|
|06|uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f5s-3-1+1+3|32|48|0.3412|0.4716|
|07|uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f7s-5-3-1+1+3+5|32|48|0.3531|0.4878|


## ft exps
|id|exp|bs|epoch|mAP|NDS|
|:-:|:-:|:-:|:-:|:-:|:-:|
|00|uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f4s135|32|48|0.3230|0.4659|
|01|uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f4s135_ft4_lr1e-4|32|48|0.3258|0.4532|
|02|uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f4s135_ft4_lr1e-4_nodecay|32|48|0.3296|0.4488|
|03|uniconv_v0.1_e48_s256x704_v200x200x6_seq3.1_ibaug_v2_interval1_f4s135_ft4_lr1e-5|32|48|0.3274|0.4629|


## 3dhead exps
|id|exp|bs|epoch|mAP|NDS|
|:-:|:-:|:-:|:-:|:-:|:-:|
|00|uniconv_v0.1_e12_s256x704_v200x200x6|16|12|0.2590|0.3277|
|01|uniconv_v0.1_e12_s256x704_v200x200x12|16|12|0.2572|0.3239|
|02|uniconv_v0.1_e12_s544x960_v200x200x12|16|12|0.2946|0.3524|
|03|uniconv_v0.1_e12_s544x960_v400x400x12|16|12|0.2954|0.3656|
|04|uniconv_v0.1_e12_s928x1600_v200x200x12|16|12|0.3218|0.3703|
|05|uniconv_v0.1_e12_s928x1600_v400x400x12|16|12|0.3248|0.3803|


## aug exps
|id|exp|bs|epoch|mAP|NDS|
|:-:|:-:|:-:|:-:|:-:|:-:|
|00|uniconv_v0.1_e12_s256x704_v200x200x12|16|12|0.2572|0.3239|
|01|uniconv_v0.1_e12_s256x704_v200x200x12_imgaug|16|12|0.2634|0.3290|
|02|uniconv_v0.1_e12_s256x704_v200x200x12_bevaug|16|12|0.2454|0.3260|
|03|uniconv_v0.1_e12_s256x704_v200x200x12_ibaug|16|12|0.2454|0.3236|
|04|uniconv_v0.1_e24_s256x704_v200x200x12|16|24|0.2538|0.3362|
|05|uniconv_v0.1_e24_s256x704_v200x200x12_imgaug|16|24|0.2769|0.3468|
|06|uniconv_v0.1_e24_s256x704_v200x200x12_bevaug|16|24|0.2577|0.3472|
|07|uniconv_v0.1_e24_s256x704_v200x200x12_ibaug|16|24|0.2589|0.3473|
|08|uniconv_v0.1_e48_s256x704_v200x200x12|32|48|0.2493|0.3349|
|09|uniconv_v0.1_e48_s256x704_v200x200x12_imgaug|32|48|0.2846|0.3557|
|10|uniconv_v0.1_e48_s256x704_v200x200x12_bevaug|32|48|0.2638|0.3539|
|11|uniconv_v0.1_e48_s256x704_v200x200x12_ibaug|32|48|0.2741|0.3663|
|12|uniconv_v0.1_e48_s256x704_v200x200x6|32|48|0.2461|0.3219|
|13|uniconv_v0.1_e48_s256x704_v200x200x6_imgaug|32|48|0.2822|0.3511|
|14|uniconv_v0.1_e48_s256x704_v200x200x6_bevaug|32|48|0.2581|0.3483|
|15|uniconv_v0.1_e48_s256x704_v200x200x6_bevaug_v2|32|48|0.2610|0.3498|
|16|uniconv_v0.1_e48_s256x704_v200x200x6_ibaug|32|48|0.2717|0.3572|
|17|uniconv_v0.1_e48_s256x704_v200x200x6_ibaug_v2|32|48|0.2877|0.3720|


## sequential exps
|id|exp|bs|epoch|mAP|NDS|
|:-:|:-:|:-:|:-:|:-:|:-:|
|00|uniconv_v0.1_e12_s256x704_v200x200x6|16|12|0.2590|0.3277|
|01|uniconv_v0.1_e48_s256x704_v200x200x6|32|48|0.2461|0.3219|
|02|uniconv_v0.1_e48_s256x704_v200x200x6_seq2.0|32|48|0.2751|0.4048|
|03|uniconv_v0.1_e48_s256x704_v200x200x6_seq2.0_ibaug_v2|32|48|0.3181|0.4450|


## bev exps
|id|exp|bs|epoch|mAP|NDS|
|:-:|:-:|:-:|:-:|:-:|:-:|
|00|uniconv_v0.1_e12_s256x704_v200x200x6|16|12|0.2590|0.3277|
|01|uniconv_v0.1_e48_s256x704_v200x200x6|32|48|0.2461|0.3219|
|02|uniconv_v0.1_e48_s256x704_v200x200x6_imgaug|32|48|0.2822|0.3511|
|03|uniconv_v0.1_e48_s256x704_v200x200x6_bevaug_v2|32|48|0.2610|0.3498|
|04|uniconv_v0.1_e48_s256x704_v200x200x6_ibaug_v2|32|48|0.2877|0.3720|
|05|uniconv_v0.1_e48_s256x704_v200x200x6_seq2.0|32|48|0.2751|0.4048|
|06|uniconv_v0.1_e48_s256x704_v200x200x6_seq2.0_ibaug_v2|32|48|0.3181|0.4450|
|07|uniconv_v0.1_e48_s704x1208_v125x125x4|32|48|0.2797|0.3470|
|08|uniconv_v0.1_e48_s704x1208_v125x125x4_ibaug_v2|32|48|0.3288|0.4124|
|07|uniconv_v0.1_e48_s704x1208_v125x125x4_seq2.0|32|48|0.3062|0.4043|
|09|uniconv_v0.1_e48_s704x1208_v125x125x4_seq2.0_ibaug_v2|32|48|0.3568|0.4748|


## mt exps
|id|exp|bs|epoch|mAP|NDS|road-IoU|lane-IoU|mIoU|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|00|uniconv_seg_v0.1_e12_s256x704_v200x200x6|32|12|0.2451|0.3162|0.691|0.309|0.500|
|01|uniconv_seg_v0.1_e12_s256x704_v200x200x6_bs16|16|12|0.2526|0.3216|0.689|0.308|0.498|
|02|uniconv_seg_v0.1_e48_s256x704_v200x200x6|32|48|0.2409|0.3145|0.697|0.316|0.507|
|03|uniconv_seg_v0.1_e48_s256x704_v200x200x6_imgaug|32|48|0.2708|0.3487|0.731|0.348|0.5395|
|04|uniconv_seg_v0.1_e48_s256x704_v200x200x6_seq2.0|32|48|0.2672|0.3533|0.710|0.335|0.523|
|05|uniconv_seg_v0.1_e48_s256x704_v200x200x6_seq2.0_imgaug|32|48|0.2972|0.4018|0.746|0.364|0.555|

